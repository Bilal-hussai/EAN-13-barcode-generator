<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UltraFast EAN-13 Barcode Generator — Jarvis</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  :root{
    --bg:#f7f9fb; --card:#ffffff; --text:#0f1724; --muted:#000000;
    --accent1:#000000; --accent2:#000000; --accent-dark:#e55800;
    --border:#000000; --radius:12px; --shadow: 0 8px 24px rgba(15,23,36,0.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:var(--bg); color:var(--text)}
  .wrap{max-width:980px;margin:28px auto;padding:18px}
  header{display:flex;flex-direction:column;gap:6px;align-items:center;margin-bottom:14px}
  h1{font-size:1.35rem;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:0.95rem;text-align:center}

  .layout{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
  @media(max-width:900px){.layout{grid-template-columns:1fr}}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  label{display:block;font-size:0.92rem;color:var(--muted);margin-bottom:8px}
  input[type=text], input[type=number], textarea, select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;font-size:1rem}
  textarea{min-height:120px;resize:vertical}

  .row{display:flex;gap:10px}
  .row > *{flex:1}
  .small{font-size:0.9rem;color:var(--muted)}

  /* Shopify-like primary button with dark hover effect */
  .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;transition:all .18s cubic-bezier(.2,.9,.2,1)}
  .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;box-shadow:0 8px 24px rgba(0,179,126,0.12)}
  .btn.primary:hover{background:var(--accent-dark);transform:translateY(-2px);box-shadow:0 14px 36px rgba(2,6,23,0.18)}
  .btn.ghost{background:#fff;border:1px solid var(--border);color:var(--text)}
  .btn.ghost:hover{background:#f3f6f7}

  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}

  /* Preview */
  .preview{display:flex;flex-direction:column;align-items:center;gap:12px}
  canvas{background:#fff;border-radius:8px;border:1px solid #efefef;max-width:100%}
  .meta{font-size:0.92rem;color:var(--muted)}

  /* Batch list */
  .batch-note{font-size:0.9rem;color:#334155}

  footer{margin-top:16px;text-align:center;color:var(--muted);font-size:0.92rem}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>UltraFast EAN-13 Barcode Generator</h1>
      <p class="lead">Enter 12 or 13 digits (12 → check digit auto-added). High-res PNG/SVG export. Batch mode supported. Mobile-friendly & Shopify-style UI.</p>
    </header>

    <div class="layout">
      <!-- Controls column -->
      <div class="card">
        <label for="digits">Single code (12 or 13 digits)</label>
        <input id="digits" type="text" inputmode="numeric" placeholder="e.g. 012345678901" maxlength="13" />

        <div style="display:flex;gap:10px;margin-top:10px;align-items:end">
          <div style="flex:1">
            <label class="small">Scale (px per module, higher → higher res)</label>
            <input id="scale" type="number" min="1" max="12" value="3" />
          </div>
          <div style="width:120px">
            <label class="small">Bar height (px)</label>
            <input id="height" type="number" min="40" max="400" value="120" />
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:10px;align-items:center">
          <div style="flex:1">
            <label class="small">Quiet zone (modules)</label>
            <input id="quiet" type="number" min="6" max="40" value="10" />
          </div>
          <div style="width:110px">
            <label class="small">Font size</label>
            <input id="fontSize" type="number" min="8" max="32" value="12" />
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="small">Options</label>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="toggleText" class="btn ghost">Hide Text</button>
            <div style="flex:1"></div>
            <button id="renderBtn" class="btn primary">Render</button>
          </div>
        </div>

        <div class="controls">
          <button id="downloadPng" class="btn primary">Export PNG (Hi-Res)</button>
          <button id="downloadSvg" class="btn ghost">Export SVG</button>
          <button id="copyBtn" class="btn ghost">Copy Number</button>
          <button id="exampleBtn" class="btn ghost">Example</button>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid var(--border)">

        <label for="batch">Batch Mode (one code per line)</label>
        <textarea id="batch" placeholder="Paste multiple 12/13-digit codes here — one per line"></textarea>
        <div style="display:flex;gap:10px;margin-top:8px">
          <button id="batchRender" class="btn primary">Render Batch</button>
          <button id="batchZip" class="btn ghost">Download Batch</button>
        </div>
        <p class="batch-note" style="margin-top:10px">Batch mode will generate individual barcodes for each valid line. Invalid lines are skipped.</p>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div class="meta">Status: <span id="status">Ready</span></div>
          <div style="font-size:0.9rem;color:var(--muted)">Made for Jarvis</div>
        </div>
      </div>

      <!-- Preview column -->
      <div class="card preview">
        <canvas id="barcodeCanvas" width="620" height="200" aria-label="EAN-13 preview"></canvas>
        <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
          <div class="meta">EAN-13 Preview</div>
          <div style="display:flex;gap:8px">
            <div class="small">Digits: <strong id="hrDigits">-</strong></div>
            <div class="small">Resolution: <strong id="resInfo">-</strong></div>
          </div>
        </div>
      </div>
    </div>

    <footer>barcode generator • SVG & Hi-Res PNG • credit for bilal </footer>
  </div>

<script>
/* EAN-13 encoding tables */
const L = {'0':'0001101','1':'0011001','2':'0010011','3':'0111101','4':'0100011','5':'0110001','6':'0101111','7':'0111011','8':'0110111','9':'0001011'};
const G = {'0':'0100111','1':'0110011','2':'0011011','3':'0100001','4':'0011101','5':'0111001','6':'0000101','7':'0010001','8':'0001001','9':'0010111'};
const R = {'0':'1110010','1':'1100110','2':'1101100','3':'1000010','4':'1011100','5':'1001110','6':'1010000','7':'1000100','8':'1001000','9':'1110100'};
const PAR = {'0':['L','L','L','L','L','L'],'1':['L','L','G','L','G','G'],'2':['L','L','G','G','L','G'],'3':['L','L','G','G','G','L'],'4':['L','G','L','L','G','G'],'5':['L','G','G','L','L','G'],'6':['L','G','G','G','L','L'],'7':['L','G','L','G','L','G'],'8':['L','G','L','G','G','L'],'9':['L','G','G','L','G','L']};

/* UI refs */
const digitsEl = document.getElementById('digits');
const renderBtn = document.getElementById('renderBtn');
const downloadPng = document.getElementById('downloadPng');
const downloadSvg = document.getElementById('downloadSvg');
const copyBtn = document.getElementById('copyBtn');
const exampleBtn = document.getElementById('exampleBtn');
const canvas = document.getElementById('barcodeCanvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');
const hrDigits = document.getElementById('hrDigits');
const resInfo = document.getElementById('resInfo');
const scaleEl = document.getElementById('scale');
const heightEl = document.getElementById('height');
const quietEl = document.getElementById('quiet');
const fontSizeEl = document.getElementById('fontSize');
const toggleTextBtn = document.getElementById('toggleText');
const batchEl = document.getElementById('batch');
const batchRender = document.getElementById('batchRender');
const batchZipBtn = document.getElementById('batchZip');

let showText = true;
const onlyDigits = s => s.replace(/\D/g,'');
const setStatus = s => statusEl.textContent = s;

function computeCheckDigit(d12){
  let sumOdd=0, sumEven=0;
  for(let i=0;i<12;i++){const d=+d12.charAt(i); if(i%2===0) sumOdd+=d; else sumEven+=d;}
  const tot = sumOdd + sumEven*3; return String((10 - (tot%10))%10);
}
function validateEAN13(code){ return computeCheckDigit(code.slice(0,12)) === code.charAt(12); }

function encodeEAN13(full13){
  const first = full13.charAt(0);
  const left = full13.slice(1,7).split('');
  const right = full13.slice(7,13).split('');
  const parity = PAR[first];
  let bits = '101';
  for(let i=0;i<6;i++){ bits += (parity[i]==='L' ? L[left[i]] : G[left[i]]); }
  bits += '01010';
  for(let i=0;i<6;i++) bits += R[right[i]];
  bits += '101';
  return bits;
}

/* Draw barcode (with devicePixelRatio scaling) */
function drawBarcode(codeStr){
  const d = onlyDigits(codeStr);
  if(!(d.length===12 || d.length===13)){ setStatus('Enter 12 or 13 digits'); hrDigits.textContent='-'; clearCanvas(); return; }

  let full = d;
  if(d.length===12){ const cd = computeCheckDigit(d); full = d + cd; setStatus('12 digits — check digit added: '+cd); }
  else { if(!validateEAN13(full)) setStatus('13-digit provided — check digit mismatch'); else setStatus('13-digit valid'); }
  hrDigits.textContent = full;

  const bits = encodeEAN13(full);
  const module = Math.max(1, Math.min(12, parseInt(scaleEl.value||3,10)));
  const barH = Math.max(40, Math.min(600, parseInt(heightEl.value||120,10)));
  const quietModules = Math.max(6, Math.min(40, parseInt(quietEl.value||10,10)));
  const fontSize = Math.max(8, Math.min(40, parseInt(fontSizeEl.value||12,10)));
  const totalModules = bits.length; // 95
  const width = totalModules * module + quietModules * module * 2;
  const dpr = Math.max(1, window.devicePixelRatio || 1);

  canvas.width = Math.ceil(width * dpr);
  canvas.height = Math.ceil((barH + fontSize + 20) * dpr);
  canvas.style.width = width + 'px';
  canvas.style.height = (barH + fontSize + 20) + 'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = '#fff'; ctx.fillRect(0,0,width,barH + fontSize + 20);

  const quiet = quietModules * module;
  let x = quiet;
  for(let i=0;i<bits.length;i++){
    const bit = bits.charAt(i);
    const isGuard = (i<3)||(i>=45 && i<50)||(i>=92);
    const h = isGuard ? barH + Math.floor(barH*0.12) : barH;
    if(bit==='1'){ ctx.fillStyle='#000'; ctx.fillRect(x,0,module,h); }
    x += module;
  }

  if(showText){
    ctx.fillStyle='#111'; ctx.font = `${fontSize}px Inter, Arial`;
    const leftStart = quiet + 3*module;
    const leftWidth = 42 * module;
    const perLeft = leftWidth / 6;
    ctx.textAlign='left'; ctx.fillText(full.charAt(0), Math.max(2, quiet - module*6), barH + 6);
    for(let i=0;i<6;i++){ ctx.textAlign='center'; const px = leftStart + perLeft*i + perLeft/2; ctx.fillText(full.charAt(1+i), px, barH + 6); }
    const rightStart = leftStart + leftWidth + 5*module;
    const perRight = (42*module)/6;
    for(let i=0;i<6;i++){ ctx.textAlign='center'; const px = rightStart + perRight*i + perRight/2; ctx.fillText(full.charAt(7+i), px, barH + 6); }
  }

  resInfo.textContent = `${width}×${barH} @ DPR ${dpr}`;
}

function clearCanvas(){ ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height); resInfo.textContent='-'; }

/* Export PNG at high resolution multiplier */
function exportPNG(mult=4){
  const d = onlyDigits(digitsEl.value);
  if(!(d.length===12||d.length===13)){ setStatus('Enter 12 or 13 digits'); return; }
  const full = (d.length===12)?(d+computeCheckDigit(d)):d;
  renderToPNGBlob(full,mult).then(blob=>{
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${full}.png`; document.body.appendChild(a); a.click(); a.remove(); setStatus('PNG exported'); });
}

/* Export SVG */
function exportSVG(){
  const d = onlyDigits(digitsEl.value);
  if(!(d.length===12||d.length===13)){ setStatus('Enter 12 or 13 digits'); return; }
  const full = (d.length===12)?(d+computeCheckDigit(d)):d;
  const bits = encodeEAN13(full);
  const module = Math.max(1, Math.min(12, parseInt(scaleEl.value||3,10)));
  const barH = Math.max(40, Math.min(600, parseInt(heightEl.value||120,10)));
  const quietModules = Math.max(6, Math.min(40, parseInt(quietEl.value||10,10)));
  const fontSize = Math.max(8, Math.min(40, parseInt(fontSizeEl.value||12,10)));
  const total = bits.length;
  const width = total * module + quietModules * module * 2;
  const svgParts = [];
  svgParts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${barH + fontSize + 20}">`);
  svgParts.push(`<rect width="100%" height="100%" fill="#fff"/>`);
  let x = quietModules * module;
  for(let i=0;i<bits.length;i++){ if(bits.charAt(i)==='1'){ const isGuard = (i<3)||(i>=45&&i<50)||(i>=92); const h = isGuard?barH + Math.floor(barH*0.12):barH; svgParts.push(`<rect x="${x}" y="0" width="${module}" height="${h}" fill="#000"/>`); } x += module; }
  if(showText){
    svgParts.push(`<g font-family="Inter, Arial" font-size="${fontSize}" fill="#111">`);
    svgParts.push(`<text x="${Math.max(2, quietModules*module - module*6)}" y="${barH + 6}">${full.charAt(0)}</text>`);
    const leftStart = quietModules*module + 3*module; const perLeft = (42*module)/6;
    for(let i=0;i<6;i++){ const px = leftStart + perLeft*i + perLeft/2; svgParts.push(`<text x="${px}" y="${barH + 6}" text-anchor="middle">${full.charAt(1+i)}</text>`); }
    const rightStart = leftStart + 42*module + 5*module; const perRight = (42*module)/6;
    for(let i=0;i<6;i++){ const px = rightStart + perRight*i + perRight/2; svgParts.push(`<text x="${px}" y="${barH + 6}" text-anchor="middle">${full.charAt(7+i)}</text>`); }
    svgParts.push(`</g>`);
  }
  svgParts.push(`</svg>`);
  const svgStr = svgParts.join('');
  const blob = new Blob([svgStr],{type:'image/svg+xml'}); const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=`${full}.svg`; document.body.appendChild(a); a.click(); a.remove(); setStatus('SVG exported');
}

/* Render to PNG blob (for hi-res and batch) */
function renderToPNGBlob(full13, mult=3){
  return new Promise((resolve)=>{
    const bits = encodeEAN13(full13);
    const module = Math.max(1, Math.min(12, parseInt(scaleEl.value||3,10)));
    const barH = Math.max(40, Math.min(600, parseInt(heightEl.value||120,10)));
    const quietModules = Math.max(6, Math.min(40, parseInt(quietEl.value||10,10)));
    const fontSize = Math.max(8, Math.min(40, parseInt(fontSizeEl.value||12,10)));
    const totalModules = bits.length; const width = totalModules * module + quietModules * module * 2;
    const w = Math.ceil(width * mult); const h = Math.ceil((barH + fontSize + 20) * mult);
    const off = document.createElement('canvas'); off.width=w; off.height=h; const octx = off.getContext('2d');
    octx.fillStyle='#fff'; octx.fillRect(0,0,w,h);
    const m = module * mult; const quiet = quietModules * m; let x=quiet;
    for(let i=0;i<bits.length;i++){ const bit=bits.charAt(i); const isGuard=(i<3)||(i>=45&&i<50)||(i>=92); const hh = isGuard?barH*mult + Math.floor(barH*0.12*mult):barH*mult; if(bit==='1'){ octx.fillStyle='#000'; octx.fillRect(x,0,m,hh); } x+=m; }
    if(showText){ octx.fillStyle='#111'; octx.font = `${fontSize*mult}px Inter, Arial`; const leftStart = quiet + 3*m; const leftWidth = 42*m; const perLeft = leftWidth/6; octx.textAlign='left'; octx.fillText(full13.charAt(0), Math.max(2, quiet - m*6), barH*mult + 6*mult); for(let i=0;i<6;i++){ const px = leftStart + perLeft*i + perLeft/2; octx.textAlign='center'; octx.fillText(full13.charAt(1+i), px, barH*mult + 6*mult); } const rightStart = leftStart + leftWidth + 5*m; const perRight = (42*m)/6; for(let i=0;i<6;i++){ const px = rightStart + perRight*i + perRight/2; octx.textAlign='center'; octx.fillText(full13.charAt(7+i), px, barH*mult + 6*mult); } }
    off.toBlob((blob)=>resolve(blob),'image/png');
  });
}

/* Copy number */
function copyNumber(){ const txt = onlyDigits(digitsEl.value); if(!txt) return; navigator.clipboard.writeText(txt).then(()=> setStatus('Number copied'), ()=> setStatus('Copy failed')); }

/* Batch: open images in new tab (user can save) */
async function downloadBatch(){
  const lines = batchEl.value.split(/\r?\n/).map(s=>onlyDigits(s.trim())).filter(s=>s.length===12||s.length===13);
  if(lines.length===0){ setStatus('No valid codes in batch'); return; }
  setStatus('Generating batch...');
  const win = window.open('about:blank'); if(!win){ setStatus('Popup blocked — allow popups'); return; }
  win.document.write('<html><head><title>Barcodes</title></head><body style="font-family:Inter,Arial;padding:12px">');
  for(const code of lines){
    const full = (code.length===12)?(code+computeCheckDigit(code)):code;
    const blob = await renderToPNGBlob(full,3);
    const url = URL.createObjectURL(blob);
    win.document.write(`<div style="margin:12px 0"><img src="${url}" style="max-width:100%;height:auto;border:1px solid #ddd;background:#fff;padding:8px"/><div style="margin-top:6px;color:#334155">${full}</div></div>`);
  }
  win.document.write('</body></html>');
  win.document.close();
  setStatus('Batch opened in new tab — save images manually');
}

/* Event wiring */
renderBtn.addEventListener('click', ()=> drawBarcode(digitsEl.value));
downloadPng.addEventListener('click', ()=> exportPNG(4));
downloadSvg.addEventListener('click', exportSVG);
copyBtn.addEventListener('click', copyNumber);
exampleBtn.addEventListener('click', ()=>{ digitsEl.value='012345678901'; drawBarcode(digitsEl.value); });

toggleTextBtn.addEventListener('click', ()=>{ showText = !showText; toggleTextBtn.textContent = showText ? 'Hide Text' : 'Show Text'; drawBarcode(digitsEl.value); });

batchRender.addEventListener('click', ()=>{ downloadBatch(); });
batchZipBtn.addEventListener('click', ()=>{ downloadBatch(); });

/* Debounced live render */
let t; digitsEl.addEventListener('input', ()=>{ clearTimeout(t); t=setTimeout(()=> drawBarcode(digitsEl.value), 260); });
scaleEl.addEventListener('change', ()=> drawBarcode(digitsEl.value));
heightEl.addEventListener('change', ()=> drawBarcode(digitsEl.value));
quietEl.addEventListener('change', ()=> drawBarcode(digitsEl.value));
fontSizeEl.addEventListener('change', ()=> drawBarcode(digitsEl.value));

clearCanvas(); setStatus('Ready');
</script>
</body>
</html>
